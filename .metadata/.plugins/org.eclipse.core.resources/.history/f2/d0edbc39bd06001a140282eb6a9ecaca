package Samsung;

import java.util.Scanner;

/*
 * 4:25~
 * 번호가 Xi의 배수인 원판을
 * di 방향으로
 * ki칸 회전
 * di = 0 : 시계방향
 * di = 1: 반시계방향
 * 
 * 회전후 
 * 인접하면서 수가 같은 것 을 모두 찾고 지운다.
 * 없는 경우에는 원판에 적힌 수의 평균을 구한 후 
 * 평균보다 큰 수에서 1을 빼고
 * 작은 수에는 1을 더한다.
 * 
 */
public class 기출_원판돌리기 {
	static int N,M,T;//원판 N개, 원판에 적힌 숫자 M개, 회전 T번
	static int[][] circleBoard;
	static int x,d,k;
	//x의 배수인 원판들을 대상으로
	//d 방향 ( 0: 시계 , 1 : 반시계)
	//k 칸만큼 회전
	public static void main(String[] args) {
		Scanner sc = new Scanner(System.in);
		N = sc.nextInt();
		M = sc.nextInt();
		T = sc.nextInt();
		circleBoard = new int[N+1][M];
		for(int i=1;i<=N;i++)
			for(int j=0;j<M;j++) circleBoard[i][j] = sc.nextInt();
		x = sc.nextInt();
		d = sc.nextInt();
		k = sc.nextInt();
		rotate();
	}
	private static void rotate() {
		for(int spin=0;spin<T;spin++){//회전
			for(int num=1;num<=N;num++){
				if(num%x==0){//배수면
					shift(num);//회전 
				}
			}
			adJoinCheck();
		}
		
	}
	private static void adJoinCheck() {
		boolean[][] visit = new boolean[N+1][M];
		for(int row=1;row<=N;row++) {
			for(int col=1;col<M;col++){
				if(col==(M-1)) {
					if(circleBoard[row][0]==circleBoard[row][M-1]) {
						visit[row][0]= true;
						visit[row][M-1] = true;
					}
				}else {
					if(circleBoard[row][col-1]==circleBoard[row][col]) {
						visit[row][col-1] = true;
						visit[row][col] = true;
					}
					if(circleBoard[row][col]==circleBoard[row][col+1]){
						visit[row][col]=true;
						visit[row][col+1]=true;
					}
				}
				if(row<N){
					if(circleBoard[row][col]==circleBoard[row+1][col]){
						visit[row][col] = true;
						visit[row+1][col] = true;
					}
				}
			}
			
		}
	}
	private static void shift(int num) {
		int[] tmp = new int[M];
		switch (d){
		case 0:	//시계방향
			for(int i=0;i<M;i++){
				int value = i+k;
				if(value>(M-1)){
					int mod = value%M;
					tmp[mod] = circleBoard[num][i];
				}else{//범위 넘지 않으면 그대로 대입
					tmp[value] = circleBoard[num][i];
				}
			}
			break;
		case 1: //반시계방향
			for(int i=0;i<M;i++){
				int value = i-k;
				if(value<0){//음수면
					int mod = value%M;
					if(mod==0){//나머지가 0이면
						tmp[0] = circleBoard[num][i];
					}else{//나머지가 0이 아니면
						tmp[M-mod] = circleBoard[num][i];
					}
				}else{//음수가 아니면 그냥 대입
					tmp[value] = circleBoard[num][i];
				}
			}
			break;
		}
		for(int i=0;i<M;i++) circleBoard[num][i] = tmp[i];
	}
}
